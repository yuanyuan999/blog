[scode type="lblue"]单活[/scode]

数据中心一般都会建立一个主和一个备，这样当主数据中心存储设备等发生问题，会切换到备用的，这个就是单活。

[scode type="lblue"]传统主备模式优缺点[/scode]


传统的主备模式分为：热备、冷备、双活

热备的情况下，只有主数据中心承担用户的业务，此时备数据中心对主数据中心进行实时的备份，当主数据中心挂掉以后，备数据中心可以自动接管主数据中心的业务，用户的业务不会中断，所以也感觉不到数据中心的切换。

冷备的情况下，也是只有主数据中心承担业务，但是备用数据中心不会对主数据中心进行实时备份，这时可能是周期性的进行备份或者干脆不进行备份，如果主数据中心挂掉了，用户的业务就会中断。

双活是觉得备用数据中心只做备份太浪费了，所以让主备两个数据中心都同时承担用户的业务，此时，主备两个数据中心互为备份，并且进行实时备份。一般来说，主数据中心的负载可能会多一些，比如分担60~70%的业务，备数据中心只分担40%~30%的业务。

[scode type="lblue"]双活[/scode]

上面说到单活，也不难看出来其最大问题就是主会一直在工作，而备份设备却常年休息，这样花了同样的钱一个工作一个干活这样很亏，于是就讲两个数据中心都设置成主，这样充分利用资源，避免了一个数据中心常年闲置，如果一个数据中心断了，那么另外一个数据中心还在运行，对用户来说是不可感知的。还有一个问题：如果是一个灾备中心的模式，如果主设备挂了，需要半个小时甚至两三个小时才能启动灾备中心，这样用户的交易会严重受损。

- 同城双活
- 异地双活

上面就是双活的两个分类吧，部署“双活”数据中心的难度也非常大，尤其是异地“双活”，涉及到数据同步效率问题。如果数据同步效率达不到要求，在灾难发生时就会造成一段时间的交易丢失。在异地“双活”的模式中，两地数据中心同时接纳交易，技术难度很大，需要更改众多底层程序。

### 建设双活的条件

- 应用双活：数据库双活
- 网络双活：业务网络要保证能够同时联通两个数据中心
- 数据要双活：两边数据能够实现被独立使用

### 双活的缺点

双活除了上面的优点当然也是有缺点的：

#### 脑裂现象

这个现象在很多双活解决方案里出现的最多，在意外事件发生时，若监测技术不到位、系统平台不健康、两数据中网络波动性中断等因素的发生，使得两个数据中心一体化的业务系统会分裂成两个独立的数据中心。使用户很难取舍那一个是唯一的生产数据，那一个是将要废掉的非生产数据。

#### 非“零丢失”

在发生一些大型灾难的时候双活是“零“数据丢失，一般不出现什么问题，但是若双活平台本身不健康或者遭遇逻辑故障时，并不能保障数据零丢失。发生这种情况还要用数据恢复的手段来恢复数据，很麻烦，在2012年的时候某省政府部门业务出现这种情况之后，宕机了一周才将数据恢复出来。

#### 需容忍高可靠性及性能的下降

这个可以理解为双活是一个提升了站点级的冗余保护，但是实际上整体业务的可靠性很难保障。还要考虑网络延迟等等。

 [scode type="lblue"]仲裁服务器[/scode]

看这名字就容易理解，就是说，做了双活的时候。两个都是老大，这时候需要一个裁判来判别哪个服务器应该是主服务器。一个仲裁服务器可担任多个镜像系统的仲裁服务器。仲裁服务器还可以担当其它数据库的数据库服务器。当双活Pair的存储设备间出现通信异常时，仲裁服务器可以决定该由哪一站点继续为业务提供服务，从而最大程度提高业务的连续性。

#### 配置仲裁服务器条件

- 存储阵列和仲裁服务器上的双活仲裁证书有效。双活的默认仲裁证书的有效期限为10年，为保证默认仲裁证书的时间有效，请确保仲裁服务器的系统时间正常。
- 仲裁服务器业务IP配置正确，防火墙端口号（30002）正确打开。
- 仲裁服务器上的白名单配置正确（默认安全策略下可不检查）。

